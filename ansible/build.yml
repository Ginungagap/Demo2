---
- name: build
  gather_facts: No
  hosts: localhost

  tasks:
  - name: Docker Login
    docker_login:
      registry: https://gcr.io
      username: _json_key
      debug: true
      password: " {{ lookup('file', '/var/lib/jenkins/credentials/project-for-terraform.json')}}"

  - name: Clone front-end
    git:
      repo: 'https://github.com/Ginungagap/front-end.git'
      dest: /var/lib/jenkins/repositories/front-end
#    become: yes
#    become_user: root
#    become_method: sudo
 
  - name: Build and push front-end image
    docker_image:
      build:
        path: /var/lib/jenkins/repositories/front-end
      name: gcr.io/project-for-terraform/front-end 
      push: yes
      pull: yes 
      source: build

  - name: Remove front-end image
    docker_image:
      state: absent
      name: gcr.io/project-for-terraform/front-end
